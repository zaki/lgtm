(function(){var e,t;e=function(){function e(){}return e.refreshRate=3e5,e.positiveKeywordsRegexes=[],e.negativeKeywordsRegexes=[],e.defaultOptions={"positive-keywords":":+1:\nlgtm\n:thumbsup:","negative-keywords":":-1:\n:thumbsdown:","disable-merge":!0,"disable-merge-threshold":3,"disable-wip":!0,"disable-wip-keywords":"wip\ndo not merge","change-favicon":!0},e.prototype.initialize=function(){return refresh()},e.prototype.regexify=function(e){return $.map(e.split(/\n/),function(e){return 0!==e.length&&e.trim()?RegExp(e.replace(/[\-\/\\\^\$\*\+\?\.\(\)\|\[\]\{\}]/g,"\\$&"),"gi"):null})},e.prototype.formatCount=function(e){return e>0?"+"+e:""+e},e.prototype.countVotes=function(e){var t,i,r,n;n={},$(".timeline-comment-wrapper",e).each(function(e){return function(t,i){var r,s,o,a,d,l,u,c,p,h,g,m;if(o=$(i).find(".comment-body p").html(),s=$(i).find(".timeline-comment-header-text .author").text(),o||""===o){for(p=!1,c=!1,h=e.positiveKeywordsRegexes,a=0,l=h.length;l>a;a++)m=h[a],o.match(m)&&(p=!0);for(g=e.negativeKeywordsRegexes,d=0,u=g.length;u>d;d++)m=g[d],o.match(m)&&(c=!0);return p||c?(n[s]||(n[s]={}),p&&(n[s].vote=1),c&&(n[s].vote=-1),(r=n[s]).thumb||(r.thumb=$(i).find(".timeline-comment-avatar").prop("src"))):void 0}}}(this)),r=0;for(t in n)i=n[t],r+=i.vote;return[r,n]},e.prototype.processPullRequest=function(e,t){return $.get(e,function(e){return function(i){var r,n,s;return r=e.countVotes(i),n=r[0],s=r[1],e.addStatus(n,s,t)}}(this))},e.prototype.addStatus=function(e,t,i){var r;return r=$(".issue-title-link",i).html(),this.isWIP(r)&&$(i).addClass("lgtm-wip"),$(".lgtm",i).remove(),0!==e?$.get(chrome.extension.getURL("templates/pr-list-status.tpl"),function(r){return function(n){var s,o,a,d,l,u;s=$("<span>"),s.addClass("lgtm"),l=[];for(a in t)u=t[a],l.push(u.thumb);return o=e>5?"&hellip;":"",d=Mustache.render(n,{count:r.formatCount(e),participants:l.slice(0,6),ellipsis:o}),s.html(d),$(".issue-meta",i).append(s)}}(this)):void 0},e.prototype.isWIP=function(e){var t,i,r,n;if(e&&this.disableWIP)for(r=this.disableWIPKeywordsRegexes,t=0,i=r.length;i>t;t++)if(n=r[t],e.match(n))return!0;return!1},e.prototype.addVotes=function(e,t,i){var r;return $(".lgtm",i).remove(),$.get(chrome.extension.getURL("templates/pr-status.tpl"),function(r){return function(n){var s,o,a,d,l;s=$("<span>"),s.addClass("lgtm"),d=[];for(o in t)l=t[o],d.push(l.thumb);return a=Mustache.render(n,{count:r.formatCount(e),participants:d}),s.html(a),$(i).append(s)}}(this)),this.disableMerge&&e<this.disableMergeThreshold&&($(".js-merge-branch-action").prop("disabled",!0),$(".js-merge-branch-action").text("Not reviewed")),r=$(".js-issue-title").html(),this.isWIP(r)?($(".js-merge-branch-action").prop("disabled",!0),$(".js-merge-branch-action").text("WIP")):void 0},e.prototype.refresh=function(){return chrome.storage.sync.get(null,function(e){return function(t){var i,r,n,s;return r=e.constructor.defaultOptions,t["positive-keywords"]||(t["positive-keywords"]=r["positive-keywords"]),t["negative-keywords"]||(t["negative-keywords"]=r["negative-keywords"]),t["disable-merge-threshold"]||(t["disable-merge-threshold"]=r["disable-merge-threshold"]),null===t["disable-merge"]&&(t["disable-merge"]=r["disable-merge"]),null===t["disable-wip"]&&(t["disable-wip"]=r["disable-wip"]),t["disable-wip-keywords"]||(t["disable-wip-keywords"]=r["disable-wip-keywords"]),null===t["change-favicon"]&&(t["change-favicon"]=r["change-favicon"]),e.positiveKeywordsRegexes=e.regexify(t["positive-keywords"]),e.negativeKeywordsRegexes=e.regexify(t["negative-keywords"]),e.disableMerge=t["disable-merge"],e.disableMergeThreshold=t["disable-merge-threshold"],e.disableWIP=t["disable-wip"],e.disableWIPKeywordsRegexes=e.regexify(t["disable-wip-keywords"]),e.changeFavicon=t["change-favicon"],n=e.countVotes($(".view-pull-request")),i=n[0],s=n[1],e.addVotes(i,s,$(".discussion-sidebar")),e.changeFavicon&&e.setFavicon(i),$(".table-list-issues .table-list-item").each(function(t,i){return e.processPullRequest($(".issue-title-link",i).prop("href"),i)})}}(this))},e.prototype.setFavicon=function(e){var t;return t=$("link[type='image/x-icon']"),e?chrome.runtime.sendMessage({message:"lgtm:update-favicon",count:e},function(e){return t.prop("href",e.dataurl)}):t.prop("href","https://assets-cdn.github.com/favicon.ico")},e}(),t=$("<script>"),t.prop("src",chrome.extension.getURL("js/pushstate.js")),$("head").append(t),window.lgtm=new e,$(function(){return window.lgtm.refresh()}),window.addEventListener("message",function(e){return"lgtm:refresh"===e.data.action?window.lgtm.refresh():void 0})}).call(this);